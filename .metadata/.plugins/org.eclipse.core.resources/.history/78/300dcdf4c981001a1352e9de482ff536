if(sessionStorage.getItem("Name") == null){
	window.location.href = "/login.html";
}


$(document).ready(function() {
    
	var json = JSON.parse(sessionStorage.getItem("Name"));
	
	$("#userNameId").text(json.surname);
	$('#money').text(json.money + "$");
	
	
	$("#sellMarket").click(function(){
		
		$("#home").hide();
		$("#sell").show()
		
		//First AJAX call to get the cards of the user
		$.ajax({
			  url:"/UserService/user/cards/" + json.id,
			  type:"GET",
			  success: function( data ){
				  var cards = data.split("/");
				  console.log(cards);
				  var i;
				  for(i=0; i < cards.length; i++ ){
					  
					  //Second AJAX call for each card to get their attributes
					  $.ajax({
						  url:"/CardService/" + cards[i],
						  type:"GET",
						  success: function( data ){
							  var json = JSON.parse(data);
							  console.log(json);
							  $("#imgrow").append("<tr class = 'cardchild'><td>" +
		                              "<img  class='ui avatar image' src='"+ json.imgurl +"'> <span class = 'Name'>"+ json.name +" </span>" +
		                          "</td>" +
		                          "<td class='Attack'>"+ json.attack +"</td>"+
		                          "<td class='Defence'>"+ json.defence +"</td>"+
		                          "<td class='Price'>"+ json.price +"</td>"+
		                          "<td class='Description' style='display:none'>" + json.description + "</td>" + 
		                          "<td>"+
		                              "<div class='ui vertical animated button' tabindex='0'>"+
		                                  "<div class='hidden content'>Sell</div>"+
		                                  "<div class='visible content'>"+
		                                      "<i class='shop icon'></i>"+
		                                  "</div>"+
		                              "</div>"+
		                          "</td></tr>");
							  
						
						  }
					  });
					  
					 
					  
				  }
				  
				  $("#imgrow").on("click", ".cardchild" ,function(){
					  
					var imgUrl = $(this).find(".ui avatar image").attr('src');
					var name = $(this).find(".Name").text();
					var description = $(this).find(".Name").text();
					var attack = $(this).find(".Attack").text();
					var defence = $(this).find(".Defence").text();
					var price = $(this).find(".Price").text();
				    $('#cardImgId')[0].src=imgUrl;
				    $('#cardNameId')[0].innerText=name;
				    $('#cardAttackId')[0].innerText=attack+" Attack";
				    $('#cardDefenceId')[0].innerText=defence+" Defence";
				    $('#cardPriceId')[0].innerText=price+" $";
				});
			  }
			  
		});
		 
	});
		
		

	
});